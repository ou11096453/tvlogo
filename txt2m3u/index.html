<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TXT â‡„ M3U è½¬æ¢å·¥å…·</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='32' cy='32' r='28' fill='%2326c6da'/><rect x='20' y='20' width='12' height='16' rx='2' fill='white' opacity='0.9'/><rect x='32' y='20' width='12' height='16' rx='2' fill='white' opacity='0.9'/><path d='M30 28l4-4 4 4h-8zm-4 8l4 4 4-4h-8z' fill='white'/></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --primary-color: #2196f3;
    --secondary-color: #4caf50;
    --warning-color: #ff9800;
    --error-color: #f44336;
    --bg-color: #f5f5f5;
    --card-bg: #ffffff;
    --text-primary: #333333;
    --text-secondary: #666666;
    --border-color: #e0e0e0;
    --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
}

body {
    background-color: var(--bg-color);
    color: var(--text-primary);
    line-height: 1.2;
    padding: 10px;
    min-height: 100vh;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow);
    overflow: hidden;
}

/* å¤´éƒ¨æ ·å¼ */
header {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    padding: 15px 30px;
    text-align: center;
}

h1 {
    font-size: 1.8rem;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.title-icon {
    background: rgba(255, 255, 255, 0.2);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
}

.subtitle {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-top: 5px;
}

/* é€šç”¨æ»šåŠ¨æ¡æ ·å¼ */
::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* æš—è‰²æ¨¡å¼é€‚é… */
@media (prefers-color-scheme: dark) {
    ::-webkit-scrollbar-track {
        background: #333;
    }
    
    ::-webkit-scrollbar-thumb {
        background: #555;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: #666;
    }
}

/* ä¸»å†…å®¹åŒºåŸŸ - å·¦å³ä¸¤åˆ—å¸ƒå±€ */
.main-content {
    display: flex;
    gap: 20px;
    padding: 25px 30px;
    min-height: 764px;
}

/* å·¦ä¾§é¢æ¿ */
.left-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* è¾“å…¥åŒºåŸŸ */
.input-section {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.section-title {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    color: var(--primary-color);
    font-size: 1.1rem;
    font-weight: 600;
}

.section-title i {
    margin-right: 10px;
    font-size: 1.2rem;
}

textarea {
    width: 100%;
    flex: 1;
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 14px;
    line-height: 1.5;
    resize: vertical;
    font-family: 'Consolas', 'Monaco', monospace;
    background-color: #f9f9f9;
    color: var(--text-primary);
    transition: border-color 0.2s, box-shadow 0.2s;
    min-height: 277px;
}

textarea:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
    outline: none;
    background-color: white;
}

/* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
.file-upload-section {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 10px 15px;
    background: #f8f9fa;
    border-radius: 6px;
    border: 1px dashed var(--border-color);
}

.file-upload-section .btn {
    padding: 8px 15px;
    font-size: 0.9rem;
}

.file-upload-section input[type="file"] {
    display: none;
}

.file-name {
    font-size: 0.9rem;
    color: var(--text-secondary);
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.file-info {
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-left: auto;
}

/* æŠ˜å é…ç½®åŒºåŸŸ */
.config-collapse {
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    overflow: hidden;
}

.collapse-header {
    padding: 15px;
    background: #e8f4ff;
    color: var(--primary-color);
    font-weight: 600;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
}

.collapse-header i {
    transition: transform 0.3s ease;
}

.collapse-header.collapsed .collapse-arrow {
    transform: rotate(180deg);
}

.collapse-content {
    padding: 15px;
    max-height: 500px;
    overflow-y: auto;
    transition: max-height 0.3s ease-out;
}

.collapse-content.collapsed {
    max-height: 0;
    padding: 0 15px;
    overflow: hidden;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

input[type="text"] {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 14px;
    color: var(--text-primary);
    background-color: white;
    transition: border-color 0.2s, box-shadow 0.2s;
}

input[type="text"]:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
    outline: none;
}

/* å¤é€‰æ¡†ç»„ */
.checkbox-group {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.checkbox-group input {
    width: auto;
}

/* å³ä¾§é¢æ¿ */
.right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.output-section {
    flex: 1;
    display: flex;
    flex-direction: column;
}

/* æŒ‰é’®ç»„ */
.button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.btn {
    padding: 12px 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    color: white;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 123px;
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-primary {
    background: var(--primary-color);
}

.btn-primary:hover {
    background: #1e87e5;
}

.btn-secondary {
    background: var(--secondary-color);
}

.btn-secondary:hover {
    background: #43a047;
}

.btn-warning {
    background: var(--warning-color);
}

.btn-warning:hover {
    background: #e68900;
}

.btn-error {
    background: var(--error-color);
}

.btn-error:hover {
    background: #d32f2f;
}

.btn-info {
    background: #00bcd4;
}

.btn-info:hover {
    background: #0097a7;
}

/* é¡µè„š */
footer {
    text-align: center;
    padding: 15px;
    font-size: 0.8rem;
    color: var(--text-secondary);
    border-top: 1px solid var(--border-color);
    background: #f8f9fa;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1024px) {
    .main-content {
        flex-direction: column;
        gap: 30px;
    }
    
    .left-panel, .right-panel {
        width: 100%;
    }
}

@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    
    .container {
        border-radius: 8px;
    }
    
    header {
        padding: 20px;
    }
    
    h1 {
        font-size: 1.5rem;
        flex-direction: column;
        gap: 8px;
    }
    
    .main-content {
        padding: 15px;
    }
    
    .button-group {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        min-width: auto;
    }
    
    textarea {
        min-height: 250px;
    }
    
    .file-upload-section {
        flex-wrap: wrap;
    }
    
    .file-info {
        margin-left: 0;
        margin-top: 5px;
        width: 100%;
    }
}

@media (max-width: 480px) {
    h1 {
        font-size: 1.3rem;
    }
    
    .subtitle {
        font-size: 0.8rem;
    }
    
    .btn {
        padding: 10px 15px;
        font-size: 0.9rem;
    }
}

/* æš—è‰²æ¨¡å¼é€‚é… */
@media (prefers-color-scheme: dark) {
    :root {
        --bg-color: #222222;
        --card-bg: #333333;
        --text-primary: #f0f0f0;
        --text-secondary: #aaaaaa;
        --border-color: #444444;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    input[type="text"],
    textarea {
        background-color: #444444;
        border-color: #555555;
        color: var(--text-primary);
    }
    
    input[type="text"]:focus,
    textarea:focus {
        background-color: #444444;
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.4);
        outline: none;
    }
    
    .config-collapse {
        background-color: #383838;
        border-color: #555555;
    }
    
    .collapse-header {
        background-color: #2c3e50;
    }
    
    footer {
        background: #383838;
    }
    
    textarea {
        background-color: #383838;
    }
    
    .file-upload-section {
        background-color: #383838;
        border-color: #555555;
    }
}
</style>
</head>
<body>
<div class="container">
    <header>
        <h1>
            <span class="title-icon">
                <i class="fas fa-exchange-alt"></i>
            </span>
            TXT â‡„ M3U è½¬æ¢å·¥å…·
        </h1>
        <p class="subtitle">æ”¯æŒTXTè½¬M3Uã€M3Uè½¬TXTã€é‡æ–°åˆ†ç»„ã€é¢‘é“åå‡€åŒ–ã€Logoè‡ªåŠ¨ç”Ÿæˆ</p>
    </header>
    
    <div class="main-content">
        <!-- å·¦ä¾§é¢æ¿ -->
        <div class="left-panel">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-section">
                <div class="section-title">
                    <i class="fas fa-pencil-alt"></i>
                    è¾“å…¥å†…å®¹ (TXT æˆ– M3U åˆ—è¡¨)
                </div>
                
                <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                <div class="file-upload-section">
                    <input type="file" id="fileInput" accept=".txt,.m3u">
                    <button class="btn btn-info" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-upload"></i> ä¸Šä¼ æ–‡ä»¶
                    </button>
                    <span id="fileName" class="file-name"></span>
                    <span id="fileInfo" class="file-info">æ”¯æŒ .txt å’Œ .m3u æ ¼å¼</span>
                </div>
                
                <textarea id="input" placeholder="åœ¨æ­¤ç²˜è´´ TXT æˆ– M3U åˆ—è¡¨ï¼Œæˆ–ç›´æ¥ä¸Šä¼ æ–‡ä»¶..."></textarea>
            </div>
            
            <!-- æŠ˜å é…ç½®åŒºåŸŸ -->
            <div class="config-collapse">
                <div class="collapse-header collapsed" id="config-toggle">
                    <span>
                        <i class="fas fa-cog"></i>
                        è½¬æ¢é…ç½®
                    </span>
                    <i class="fas fa-chevron-up collapse-arrow"></i>
                </div>
                <div class="collapse-content collapsed" id="config-content">
                    <div class="form-group">
                        <label for="epg"><i class="fas fa-globe"></i> EPGåœ°å€ (TXT â†’ M3U)</label>
                        <input type="text" id="epg" value="https://e.erw.cc/all.xml.gz" placeholder="è¾“å…¥EPGåœ°å€...">
                    </div>
                    
                    <div class="form-group">
                        <label for="logoBase"><i class="fas fa-image"></i> LogoåŸºç¡€åœ°å€</label>
                        <input type="text" id="logoBase" value="https://live.404003.xyz/LOGO/" placeholder="è¾“å…¥LogoåŸºç¡€åœ°å€...">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="sanitizeDisplay" checked>
                        <label for="sanitizeDisplay">TXTè½¬M3Uæ—¶ï¼Œå¯¹é¢‘é“åè¿›è¡Œå‡€åŒ–ï¼ˆEXTINFæ˜¾ç¤ºåï¼‰</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="useTvgName">
                        <label for="useTvgName">M3Uè½¬TXTæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨tvg-name/tvg-idä½œä¸ºé¢‘é“åç§°</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="reGroup">
                        <label for="reGroup">é‡æ–°åˆ†ç»„ï¼ˆå¿½ç•¥åŸæœ‰åˆ†ç»„ï¼ŒæŒ‰è§„åˆ™åˆ†ç»„ï¼‰</label>
                    </div>
                </div>
            </div>
            
            <!-- æŒ‰é’®ç»„ -->
            <div class="button-group">
                <button class="btn btn-primary" onclick="txtToM3u()">
                    <i class="fas fa-arrow-right"></i> TXTè½¬M3U
                </button>
                <button class="btn btn-secondary" onclick="m3uToTxt()">
                    <i class="fas fa-arrow-left"></i> M3Uè½¬TXT
                </button>
                <button class="btn btn-info" onclick="reGroup()">
                    <i class="fas fa-object-group"></i> é‡æ–°åˆ†ç»„
                </button>
                <button class="btn btn-warning" onclick="clearAll()">
                    <i class="fas fa-trash-alt"></i> æ¸…ç©ºå†…å®¹
                </button>
                <button class="btn btn-error" onclick="copyOutput()">
                    <i class="fas fa-copy"></i> å¤åˆ¶ç»“æœ
                </button>
            </div>
        </div>
        
        <!-- å³ä¾§é¢æ¿ -->
        <div class="right-panel">
            <div class="output-section">
                <div class="section-title">
                    <i class="fas fa-file-code"></i>
                    è½¬æ¢ç»“æœ
                </div>
                <textarea id="output" placeholder="è½¬æ¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º..." readonly></textarea>
            </div>
        </div>
    </div>
    
    <footer>
        <p>TXT â‡„ M3U è½¬æ¢å·¥å…· &copy; 2025 | æ”¯æŒé‡æ–°åˆ†ç»„ã€é¢‘é“åå‡€åŒ–ã€Logoè‡ªåŠ¨ç”Ÿæˆ</p>
        <p style="margin-top: 5px; font-size: 0.8rem;">åŸºäºåˆ†ç»„è§„åˆ™æ™ºèƒ½åˆ†ç±»ï¼Œæ”¯æŒå¤®è§†ã€å«è§†ã€å„çœå°ã€æ¸¯æ¾³å°ã€å›½é™…é¢‘é“è‡ªåŠ¨è¯†åˆ«</p>
    </footer>
</div>

<script>
// ===== æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ =====
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('fileInput');
    const fileNameDisplay = document.getElementById('fileName');
    const fileInfoDisplay = document.getElementById('fileInfo');
    const inputArea = document.getElementById('input');
    
    fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        
        if (!file) {
            return;
        }
        
        // éªŒè¯æ–‡ä»¶ç±»å‹
        const validExtensions = ['.txt', '.m3u'];
        const fileName = file.name.toLowerCase();
        const isValidFile = validExtensions.some(ext => fileName.endsWith(ext));
        
        if (!isValidFile) {
            alert('è¯·ä¸Šä¼  .txt æˆ– .m3u æ ¼å¼çš„æ–‡ä»¶ï¼');
            fileInput.value = ''; // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            fileNameDisplay.textContent = '';
            fileInfoDisplay.textContent = 'æ”¯æŒ .txt å’Œ .m3u æ ¼å¼';
            return;
        }
        
        // æ˜¾ç¤ºæ–‡ä»¶å
        fileNameDisplay.textContent = 'ğŸ“„ ' + file.name;
        
        // æ˜¾ç¤ºæ–‡ä»¶å¤§å°
        const fileSize = formatFileSize(file.size);
        fileInfoDisplay.textContent = 'æ–‡ä»¶å¤§å°: ' + fileSize;
        
        // è¯»å–æ–‡ä»¶å†…å®¹
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const content = e.target.result;
            inputArea.value = content;
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            fileInfoDisplay.textContent = 'âœ… å·²åŠ è½½: ' + file.name + ' (' + fileSize + ')';
            
            // 3ç§’åæ¢å¤é»˜è®¤æç¤º
            setTimeout(function() {
                fileInfoDisplay.textContent = 'æ”¯æŒ .txt å’Œ .m3u æ ¼å¼';
            }, 3000);
        };
        
        reader.onerror = function() {
            alert('è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•ï¼');
            fileInput.value = '';
            fileNameDisplay.textContent = '';
            fileInfoDisplay.textContent = 'æ”¯æŒ .txt å’Œ .m3u æ ¼å¼';
        };
        
        reader.readAsText(file);
    });
});

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// ===== æŠ˜å é¢æ¿åŠŸèƒ½ =====
document.addEventListener('DOMContentLoaded', function() {
    const configToggle = document.getElementById('config-toggle');
    const configContent = document.getElementById('config-content');
    
    configToggle.addEventListener('click', function() {
        const isCollapsed = configContent.classList.contains('collapsed');
        
        if (isCollapsed) {
            // å±•å¼€
            configContent.classList.remove('collapsed');
            configToggle.classList.remove('collapsed');
        } else {
            // æŠ˜å 
            configContent.classList.add('collapsed');
            configToggle.classList.add('collapsed');
        }
    });
});

// ===== åˆ†ç»„è§„åˆ™ =====
const groupRules = [
    // ===== ä¼˜å…ˆçº§æœ€é«˜ï¼šå¤®è§†ä¸å«è§† =====
    {keywords: ['CCTV','cctv','å¤®è§†','cgtn','CGTN','CETV','cetv','ä¸­å›½æ•™è‚²','é£äº‘éŸ³ä¹','é£äº‘è¶³çƒ','é£äº‘å‰§åœº','é«˜å°”å¤«','æ€€æ—§å‰§åœº','æ–‡åŒ–ç²¾å“','ç”µè§†æŒ‡å—','ä¸–ç•Œåœ°ç†','å…µå™¨ç§‘æŠ€','å¥³æ€§æ—¶å°š','ç¬¬ä¸€å‰§åœº','å«ç”Ÿå¥åº·','è€æ•…äº‹','ä¸­å­¦ç”Ÿ','å‘ç°ä¹‹æ—…'], group: 'å¤®è§†'},
    {keywords: ['å«è§†'], group: 'å«è§†'}, // é˜²æ­¢"æ¹–å—å«è§†"è¯¯åˆ†æ¹–å—

    // ===== å„çœå¸‚ =====
    {keywords: ['åŒ—äº¬','BTV','BRTV','æ·˜','èŒå® TV'], group: 'åŒ—äº¬'},
    {keywords: ['å¤©æ´¥'], group: 'å¤©æ´¥'},
    {keywords: ['ä¸Šæµ·'], group: 'ä¸Šæµ·'},
    {keywords: ['é‡åº†'], group: 'é‡åº†'},
    {keywords: ['æ²³åŒ—'], group: 'æ²³åŒ—'},
    {keywords: ['å±±è¥¿'], group: 'å±±è¥¿'},
    {keywords: ['å†…è’™å¤','è’™è¯­'], group: 'å†…è’™å¤'},
    {keywords: ['è¾½å®'], group: 'è¾½å®'},
    {keywords: ['å‰æ—'], group: 'å‰æ—'},
    {keywords: ['é»‘é¾™æ±Ÿ'], group: 'é»‘é¾™æ±Ÿ'},
    {keywords: ['æ±Ÿè‹'], group: 'æ±Ÿè‹'},
    {keywords: ['æµ™æ±Ÿ'], group: 'æµ™æ±Ÿ'},
    {keywords: ['å®‰å¾½'], group: 'å®‰å¾½'},
    {keywords: ['ç¦å»º'], group: 'ç¦å»º'},
    {keywords: ['æ±Ÿè¥¿'], group: 'æ±Ÿè¥¿'},
    {keywords: ['å±±ä¸œ'], group: 'å±±ä¸œ'},
    {keywords: ['æ²³å—'], group: 'æ²³å—'},
    {keywords: ['æ¹–åŒ—'], group: 'æ¹–åŒ—'},
    {keywords: ['æ¹–å—','é•¿æ²™','å®ä¹¡','æµé˜³','æ ªæ´²','æ¹˜æ½­','å²³é˜³','ç›Šé˜³','å¸¸å¾·','å¨„åº•','å¼ å®¶ç•Œ','æ€€åŒ–','è¡¡é˜³','éƒ´å·','æ¹˜è¥¿','æ°¸å·','é‚µé˜³','æ½‡æ¹˜ç”µå½±'], group: 'æ¹–å—'},
    {keywords: ['å¹¿ä¸œ','ç æ±Ÿ','å¤§æ¹¾åŒº'], group: 'å¹¿ä¸œ'},
    {keywords: ['å¹¿è¥¿'], group: 'å¹¿è¥¿'},
    {keywords: ['æµ·å—'], group: 'æµ·å—'},
    {keywords: ['å››å·'], group: 'å››å·'},
    {keywords: ['è´µå·'], group: 'è´µå·'},
    {keywords: ['äº‘å—'], group: 'äº‘å—'},
    {keywords: ['è¥¿è—','è—è¯­'], group: 'è¥¿è—'},
    {keywords: ['é™•è¥¿'], group: 'é™•è¥¿'},
    {keywords: ['ç”˜è‚ƒ'], group: 'ç”˜è‚ƒ'},
    {keywords: ['é’æµ·'], group: 'é’æµ·'},
    {keywords: ['å®å¤'], group: 'å®å¤'},
    {keywords: ['æ–°ç–†','å…µå›¢'], group: 'æ–°ç–†'},
	//{keywords: ['å°æ¹¾','å°ç£','ç½ªæ¡ˆåµç·','æ°‘è§†','æ°‘è¦–','ä¸­è§†','ä¸­è¦–','å°è§†','å°è¦–','å…¬è§†','å…¬è¦–','åè§†','è¯è¦–','çº¬æ¥','ç·¯ä¾†','æ—¶ä»£','å½±è¿·æ•¸ä½','å½±è¿·æ•°ä½','åè‰º','è¯è—','åè—','è¯è—','å¥½æ¶ˆæ¯','ä½›å«','ä½›è¡›','ç”Ÿå‘½ç”µè§†','ç”Ÿå‘½é›»è¦–','é–å¤©','æ–°å”äºº','æ­£å¾·','äººé—´å«è§†','äººé–“è¡›è¦–','å…«å¤§','ä¸‰ç«‹','å¤§ç«‹','å¤§çˆ±','å¤§æ„›','å›½ä¼š','åœ‹æœƒ','ä¿¡å‰','å† å†›','å† è»','å®¢å®¶','å¤©å¤©','ç¾å¥½','åŸä½æ°‘','çˆ±å°”è¾¾','æ„›çˆ¾é”','å”¯å¿ƒ','æ›¼è¿ª','å¯°å®‡','å¯Œç«‹','è¾¾æ–‡è¥¿','é”æ–‡è¥¿','äºšæ´²','äºæ´²','é•œç”µè§†','é¡é›»è¦–','éå‡¡','å£¹ç”µè§†','å£¹é›»è¦–','é¾™å','é¾è¯','é‡‡æ˜Œ','ç¾äºš','ç¾äº','æ»šåŠ¨åŠ›','æ»¾å‹•åŠ›','é–æ´‹','ä¸œæ£®','æ±æ£®','å¹¸ç¦ç©ºé—´','å¹¸ç¦ç©ºé–“','æ¾è§†','æ¾è¦–','é¦™è•‰å°','æ½˜æœµå•¦','é©šè±”','å½©è™¹','åšæ–¯','æ™ºæ—','momo','Discovery','å†å²é¢‘é“','æ­·å²é »é“','ç¾é£Ÿæ˜Ÿçƒ','è§†çº³åä»','è¦–ç´è¯ä»','TVBS','tvN','KLT','Arirang','Animax','Medici','ROCK ACTION','Warner TV','NHK','åŠå²›','åŠå°','Al Jazeera','Channel NewsAsia','CinemaWorld','CNBC','CMusic','MTV','CLASSICA','KMTV','ELEVEN SPORTS','NBA','TRACE','Travel Channel','TV5MONDE','Asian Food Network','EYE TV','INULTRA','Lifetime','LOVE NATURE','LUXE TV','Mezzo Live','SmartçŸ¥è­˜å°','TaiwanPlus','TechStorm','Food Network','FRANCE24','Global Trekker','GOOD TV','amcç”µå½±','amcé›»å½±','CatchPlay','My Cinema Europe','i-Fun','Nickelodeon','CARTOONITO','CBeebies','DMAX','DreamWorks','å¾·åœ‹ä¹‹è²','ELTV','ETtoday','Euronews','EUROSPORT','EVE','HITS','PET CLUB TV','ROCK Entertainment','ROCK Extreme','JStar','Ké »é“','HAPPY','æ™‚å°šé »é“'],group: 'å°æ¹¾'},
	{keywords: ['CatchPlayé›»å½±', 'CatchPlayç”µå½±', 'CinemaWorld', 'EYE TVæˆ²åŠ‡', 'EYE TVæˆå‰§', 'HITS', 'ROCK ACTION', 'ROCK Entertainment', 'ROCK Extreme', 'Warner TV', 'amcé›»å½±', 'amcç”µå½±', 'My Cinema Europe', 'My Cinema Europe', 'ä¸‰ç«‹æˆ²åŠ‡', 'ä¸‰ç«‹æˆå‰§', 'å°ç£æˆ²åŠ‡', 'å°æ¹¾æˆå‰§', 'å°ç£é›»è¦–åŠ‡', 'å°æ¹¾ç”µè§†å‰§', 'å£¹é›»è¦–é›»å½±', 'å£¹ç”µè§†ç”µå½±', 'ç½ªæ¡ˆåµç·', 'ç½ªæ¡ˆä¾¦ç¼‰', 'ç¾äºé›»å½±', 'ç¾äºšç”µå½±', 'è¯è—å½±åŠ‡', 'åè‰ºå½±å‰§', 'é‡‡æ˜Œå½±åŠ‡', 'é‡‡æ˜Œå½±å‰§', 'é–å¤©æˆ²åŠ‡', 'é–å¤©æˆå‰§', 'é–å¤©æ˜ ç•«', 'é–å¤©æ˜ ç”»', 'é–å¤©é›»å½±', 'é–å¤©ç”µå½±', 'é–æ´‹æˆ²åŠ‡', 'é–æ´‹æˆå‰§', 'é¾è¯å¶åƒ', 'é¾™åå¶åƒ', 'é¾è¯å½±åŠ‡', 'é¾™åå½±å‰§', 'é¾è¯æˆ²åŠ‡', 'é¾™åæˆå‰§', 'é¾è¯æ´‹ç‰‡', 'é¾™åæ´‹ç‰‡', 'é¾è¯ç¶“å…¸', 'é¾™åç»å…¸', 'é¾è¯é›»å½±', 'é¾™åç”µå½±', 'å½±è¿·æ•¸ä½é›»å½±', 'å½±è¿·æ•°ä½ç”µå½±','æ„›çˆ¾é”å½±åŠ‡','çˆ±å°”è¾¾å½±å‰§'], group: 'å°æ¹¾-å½±è§†'},
	{keywords: ['Arirang TV', 'CLASSICA HD', 'CMusic', 'LUXE TV Channel', 'Medici-arts', 'Mezzo Live HD', 'MTV Live', 'MTVç¶œåˆé›»è¦–', 'MTVç»¼åˆç”µè§†', 'TV5MONDE STYLE HD', 'TV5MONDE', 'tvN', 'éŸ“åœ‹å¨›æ¨‚', 'éŸ©å›½å¨±ä¹', 'æ»¾å‹•åŠ›', 'æ»šåŠ¨åŠ›', 'æ™‚å°š',  'TVBSæ­¡æ¨‚', 'TVBSæ¬¢ä¹', 'TVBSç²¾é‡‡', 'TVBSç²¾å½©', 'ç·¯ä¾†ç²¾é‡‡', 'çº¬æ¥ç²¾å½©', 'ä¸­è¦–èé‡‡', 'ä¸­è§†èé‡‡'], group: 'å°æ¹¾-å¨±ä¹'},
	{keywords: ['BBC World News', 'Bloomberg TV', 'CNBC Asia Channel', 'CNN International', 'Channel NewsAsia', 'Channel NewsAsia', 'Euronews', 'FRANCE24(English)', 'FRANCE24(French)', 'NHKæ–°èè³‡è¨Š', 'NHKæ–°é—»èµ„è®¯', 'TaiwanPlus', 'TVBSæ–°è', 'TVBSæ–°é—»', 'ä¸­è¦–æ–°è', 'ä¸­è§†æ–°é—»', 'å°è¦–æ–°è', 'å°è§†æ–°é—»', 'å£¹é›»è¦–æ–°è', 'å£¹ç”µè§†æ–°é—»', 'å¯°å®‡æ–°è', 'å¯°å®‡æ–°é—»', 'å¯°å®‡è²¡ç¶“', 'å¯°å®‡è´¢ç»', 'è¯è¦–æ–°èè³‡è¨Š', 'åè§†æ–°é—»èµ„è®¯', 'é¡é›»è¦–æ–°è', 'é•œç”µè§†æ–°é—»', 'é–å¤©è³‡è¨Š', 'é–å¤©èµ„è®¯', 'éå‡¡æ–°è', 'éå‡¡æ–°é—»', 'åŠå³¶è‹±èªæ–°è', 'åŠå²›è‹±è¯­æ–°é—»', 'ä¸‰ç«‹è²¡ç¶“æ–°è', 'ä¸‰ç«‹è´¢ç»æ–°é—»'], group: 'å°æ¹¾-æ–°é—»'},
	{keywords: ['ELEVEN SPORTS', 'EUROSPORT', 'NBAå‹•æ…‹', 'NBAåŠ¨æ€', 'TRACE Sport Stars', 'ä¸–ç•Œç¾½çƒé›œèªŒ', 'ä¸–ç•Œç¾½çƒæ‚å¿—', 'åšæ–¯ç„¡é™', 'åšæ–¯æ— é™', 'åšæ–¯ç¶²çƒ', 'åšæ–¯ç½‘çƒ', 'åšæ–¯é‹å‹•', 'åšæ–¯è¿åŠ¨', 'åšæ–¯é«˜çƒ', 'åšæ–¯é­…åŠ›', 'è¯è¦–æ•™è‚²é«”è‚²æ–‡åŒ–', 'åè§†æ•™è‚²ä½“è‚²æ–‡åŒ–', 'æ™ºæ—é«”è‚²', 'æ™ºæ—ä½“è‚²', 'æ„›çˆ¾é”äºé‹', 'çˆ±å°”è¾¾äºšè¿', 'æ„›çˆ¾é”é«”è‚²', 'çˆ±å°”è¾¾ä½“è‚²', 'çˆ±å°”è¾¾ä½“è‚²'], group: 'å°æ¹¾-ä½“è‚²'},
	{keywords: ['Animax', 'CARTOONITO', 'CBeebies', 'DreamWorks', 'Nick Jr.', 'momoäº²å­', 'å°¼å…‹å…’ç«¥', 'å°¼å…‹å„¿ç«¥', 'i-Funå‹•æ¼«', 'i-FunåŠ¨æ¼«', 'æ›¼è¿ªæ—¥æœ¬', 'é–å¤©å¡é€š', 'é–æ´‹å¡é€š', 'é¾è¯å‹•ç•«', 'é¾™ååŠ¨ç”»', 'é–å¤©è‚²æ¨‚', 'é–å¤©è‚²ä¹'], group: 'å°æ¹¾-å°‘å„¿'},
	{keywords: ['HAPPY', 'å½©è™¹', 'å½©è™¹', 'æ¾è¦–', 'æ¾è§†', 'æ¾è¦–', 'æ¾è§†', 'æ¾è¦–', 'æ¾è§†', 'æ½˜æœµå•¦', 'æ½˜æœµæ‹‰', 'é¦™è•‰', 'é©šè±”', 'æƒŠè‰³', 'JStaræ¥µé™', 'JStaræé™'], group: 'å°æ¹¾-æˆäºº'},
	{keywords: ['äºæ´²æ—…éŠ', 'äºšæ´²æ—…æ¸¸', 'äºæ´²ç¶œåˆ', 'äºšæ´²ç»¼åˆ', 'BBC Earth', 'BBC Lifestyle Channel', 'Discovery', 'DMAX', 'EVE', 'Global Trekker', 'HGTV', 'INULTRA', 'Lifetime', 'LOVE NATURE', 'PET CLUB TV', 'SmartçŸ¥è­˜', 'SmartçŸ¥è¯†', 'TECHStorm', 'TechStorm', 'Travel Channel', 'DaVinCi Learningé”æ–‡è¥¿', 'DaVinCi Learningè¾¾æ–‡è¥¿', 'ELTVç”Ÿæ´»è‹±èª', 'ELTVç”Ÿæ´»è‹±è¯­', 'Asian Food Network', 'Food Network', 'EYE TVæ—…éŠ', 'EYE TVæ—…æ¸¸', 'æ­·å²', 'ç¾é£Ÿæ˜Ÿçƒ', 'ä¸­è¦–ç¶“å…¸', 'ä¸­è§†ç»å…¸', 'å°è¦–è²¡ç¶“', 'å°è§†è´¢ç»', 'å† è»é›»è¦–', 'å† å†›ç”µè§†', 'åœ‹æœƒ', 'å›½ä¼š', 'å½±è¿·æ•¸ä½ç´€å¯¦', 'å½±è¿·æ•°ä½çºªå®', 'è¦–ç´è¯ä»ç´€å¯¦', 'è§†çº³åä»çºªå®', 'å¹¸ç¦ç©ºé–“å±…å®¶', 'å¹¸ç¦ç©ºé—´å±…å®¶', 'é–å¤©æ—¥æœ¬', 'å¾·åœ‹ä¹‹è²é›»è¦–', 'å¾·å›½ä¹‹å£°ç”µè§†'], group: 'å°æ¹¾-ç”Ÿæ´»'},
	{keywords: ['GOOD TV', 'äººé–“è¡›è¦–', 'äººé—´å«è§†', 'ä½›è¡›é›»è¦–æ…ˆæ‚²', 'ä½›å«ç”µè§†æ…ˆæ‚²', 'å”¯å¿ƒé›»è¦–', 'å”¯å¿ƒç”µè§†', 'å¤§æ„›', 'å¤§çˆ±', 'å¥½æ¶ˆæ¯', 'æ­£å¾·é›»è¦–', 'æ­£å¾·ç”µè§†', 'ç”Ÿå‘½é›»è¦–', 'ç”Ÿå‘½ç”µè§†', 'è¯è—è¡›è¦–', 'åè—å«è§†', 'æ–°å”äººäºå¤ª', 'æ–°å”äººäºšå¤ª', 'ä¿¡å‰è—æ–‡', 'ä¿¡å‰è‰ºæ–‡', 'ä¿¡å‰é›»è¦–', 'ä¿¡å‰ç”µè§†'], group: 'å°æ¹¾-å®—æ•™'},
	{keywords: ['ä¸­è¦–', 'ä¸­è§†', 'å°è¦–', 'å°è§†', 'æ°‘è¦–', 'æ°‘è§†', 'å…¬è¦–', 'å…¬è§†', 'è¯è¦–', 'åè§†', 'TVBS', 'å…¬è¦–2', 'å…¬è§†2', 'å…¬è¦–3', 'å…¬è§†3', 'å…¬è¦–å°èª', 'å…¬è§†å°è¯­', 'å°è¦–ç¶œåˆ', 'å°è§†ç»¼åˆ', 'å…«å¤§å„ª', 'ä¸‰ç«‹ç¶œåˆ', 'å¤§ç«‹é›»è¦–', 'å¤©å¤©é›»è¦–', 'å®¢å®¶é›»è¦–', 'åŸä½æ°‘æ—é›»è¦–', 'å¯°å®‡ç¶œåˆ', 'å¯°å®‡ç»¼åˆ', 'å£¹é›»è¦–è³‡è¨Šç¶œåˆ', 'å£¹ç”µè§†èµ„è®¯ç»¼åˆ', 'æ„›çˆ¾é”ç¶œåˆ', 'çˆ±å°”è¾¾ç»¼åˆ', 'è¯è—ç¶œåˆ', 'åè‰ºç»¼åˆ', 'è¯è—ç£', 'åè‰ºæ¹¾', 'é–å¤©ç¶œåˆ', 'é–å¤©ç»¼åˆ', 'é–å¤©æ­¡æ¨‚', 'é–å¤©æ¬¢ä¹', 'ETtodayç¶œåˆ', 'ETtodayç»¼åˆ', 'é–å¤©åœ‹éš›', 'é–å¤©å›½é™…','å¯Œç«‹','å¯°å®‡','è¯è—','åè‰º','momo'], group: 'å°æ¹¾-ç»¼åˆ'},
	{keywords: ['æ— çº¿','TVB','ç¿¡ç¿ ','æ˜ç ','é¦™æ¸¯æœ‰çº¿','æœ‰çº¿æ–°é—»','å‡¤å‡°','é³³å‡°','NowTV','HKTV','ViuTV','é¦™æ¸¯ç”µå°','é¦™æ¸¯é›»å°','RTHK','ATV','äºæ´²é›»è¦–','å¥‡å¦™é›»è¦–','æ¾³è§†','æ¾³é—¨'],group: 'æ¸¯æ¾³'},
	{keywords: ['NHK','NHKæ•™è‚²','NHKç·åˆ','æ—¥æœ¬ç”µè§†','æ—¥æœ¬é›»è¦–','å¯Œå£«ç”µè§†','å¯Œå£«é›»è¦–','TBS','æœæ—¥ç”µè§†','æœæ—¥é›»è¦–','ç”µè§†æœæ—¥','é›»è¦–æœæ—¥','WOWOW','ä¸œäº¬ç”µè§†','æ±äº¬é›»è¦–','BS Japan','BSã‚¸ãƒ£ãƒ‘ãƒ³','æ—¥æœ¬BS','Animax Japan','NHK BS1','NHK BSãƒ—ãƒ¬ãƒŸã‚¢ãƒ '],group: 'æ—¥æœ¬'},
	{keywords: ['CNN','BBC','Al Jazeera','Bloomberg','NHK World','France 24','Sky News','Euronews','TV5Monde','Russia Today','ABC','NBC','CBS','FOX','National Geographic','Discovery Channel','Animal Planet','History Channel','Cartoon Network','HBO','Warner','Disney','Paramount','Nick Jr.','HGTV','amc','Netflix'],group: 'å›½é™…'},


    // ===== å“ç‰Œç±» =====

    {keywords: ['SiTV','SITV'], group: 'SiTV'},
    {keywords: ['çœ‹å¤©ä¸‹ç²¾é€‰','ç™¾å˜è¯¾å ‚','å¥åº·å…»ç”Ÿ','åè¯­å½±é™¢','ç”µç«å¤©å ‚','é’æ˜¥åŠ¨æ¼«','å®å®åŠ¨ç”»','æ˜Ÿå…‰é™¢çº¿','æ˜Ÿå…‰å½±é™¢','è°æˆ˜å‰§åœº','å…¨çƒå¤§ç‰‡','çƒ­é—¨å‰§åœº','æˆæ›²ç²¾é€‰','çƒ­é—¨ç»¼è‰º','ç™¾è§†é€š','bestv'], group: 'BesTV'},
    {keywords: ['å’ªå’•','ç›å½©','å’ªè§†é€š','è‡³è‡»è§†ç•Œ','å’ªè§†ç•Œ'], group: 'å’ªå’•'},
    {keywords: ['iHOT','IHOT','ihot'], group: 'iHOT'},
    {keywords: ['æ¬¢ç¬‘å‰§åœº','åŠ¨æ¼«ç§€åœº','åŠ²çˆ†ä½“è‚²','é‡‘è‰²å­¦å ‚','æ¸¸æˆé£äº‘','ç”Ÿæ´»æ—¶å°š','ä¹æ¸¸','éƒ½å¸‚å‰§åœº','ä¸œæ–¹è´¢ç»','æ–°è§†è§‰','æ³•åˆ¶å¤©åœ°','çºªå®äººæ–‡','æ³•æ²»å¤©åœ°'], group: 'SiTV'},

    {keywords: ['CHC','å½±è¿·ç”µå½±','å®¶åº­å½±é™¢','æ±‚ç´¢','é‡æ¸©ç»å…¸','ä¸­å›½å¤©æ°”','ä¸­å›½äº¤é€š','å…ˆé”‹ä¹’ç¾½','èŒ¶','å¿«ä¹å‚é’“','ä¼˜æ¼«','é‡‘é¹°','å¡é…·','å˜‰ä½³','ç‚«åŠ¨','æ•™è‚²','åŒ—äº¬çºªå®','ç§‘æ•™','æ¢¨å›­','å›½å­¦','ç¯®çƒ','æ±½æ‘©','ç¯çƒå¥‡è§‚','æ–‡ç‰©å®åº“','æ­¦æœ¯ä¸–ç•Œ','å¤©ä¸‹','æ”¶è—','ä¹¦ç”»','æ–°åŠ¨æ¼«','å›´æ£‹','å¼ˆå›æ˜¥ç§‹','4K','ä¸­ååŠŸå¤«','ç¯çƒæ—…æ¸¸','å››æµ·é’“é±¼','ä¼˜ä¼˜å®è´','ç”Ÿæ€ç¯å¢ƒ'], group: 'æ•°å­—'},	
    {keywords: ['é»‘è“','å“’å•µ','ç²¾å“å¤§å‰§','å¤è£…å‰§åœº','å†›æ—…å‰§åœº','å®¶åº­å‰§åœº','çƒ­æ’­ç²¾é€‰','çˆ±æƒ…å–œå‰§','åŠ¨ä½œç”µå½±','æƒŠæ‚šæ‚¬ç–‘','é‡‘ç‰Œç»¼è‰º','ç²¾å“ä½“è‚²','ç²¾å“èŒå® ','å†œä¸šè‡´å¯Œ','ç²¾å“ç»¼åˆ','ä¸­å›½åŠŸå¤«','æ€¡ä¼´å¥åº·','æ½®å¦ˆè¾£å©†','ç²¾å“çºªå½•','è¶…çº§ç”µå½±','è¶…çº§ä½“è‚²','è¶…çº§ç»¼è‰º','æ¬¢ä¹å‰§åœº','è¶…çº§ç”µè§†å‰§','å†›äº‹è¯„è®º','ç‚«èˆæœªæ¥','æ­¦æä¸–ç•Œ','é­…åŠ›æ½‡æ¹˜','ä¸œåŒ—çƒ­å‰§','æ˜æ˜Ÿå¤§ç‰‡','NewTV','newtv','NEWTV'], group: 'NewTV'},
	    {regex: /^çˆ±.{2}/, group: 'iHOT'}, 
    // ===== å…œåº•åˆ†ç±» =====
    {keywords: ['æ•™è‚²','å­¦ä¹ ','è¯¾å ‚'], group: 'æ•™è‚²'},
    {keywords: ['å½±è§†','å½±é™¢','ç”µå½±','å‰§åœº'], group: 'å½±è§†'},
    {keywords: ['ç»¼è‰º','å¨±ä¹'], group: 'ç»¼è‰º'},
    {keywords: ['ä½“è‚²'], group: 'ä½“è‚²'},
    {keywords: ['çºªå½•'], group: 'çºªå½•ç‰‡'},
    {keywords: ['å¹¿æ’­','ä¹‹å£°','è°ƒé¢‘','FM'], group: 'å¹¿æ’­'},
    {keywords: ['æµ‹è¯•','å›çœ‹','å¤‡ç”¨','å¹¿å‘Š'], group: 'æµ‹è¯•'},
	{keywords: ['è´­ç‰©','èšé²¨ç¯çƒç²¾é€‰','å¿«ä¹è´­','å˜‰ä¸½è´­','è³¼ç‰©'], group: 'è´­ç‰©'},
];

function matchGroup(channelName){
    for(let rule of groupRules){
        if(rule.regex && rule.regex.test(channelName)) return rule.group;
        if(rule.keywords){
            for(let kw of rule.keywords){
                if(channelName.includes(kw)) return rule.group;
            }
        }
    }
    return 'å…¶ä»–';
}

// ===== é¢‘é“åå‡€åŒ–å‡½æ•° =====
function sanitizeName(name) {
    // CCTV ç³»åˆ—å¤„ç†
    let cctvMatch = name.match(/^CCTV(\d+)([+K]?)/i);
    if (cctvMatch) {
        let num = cctvMatch[1];
        let suffix = cctvMatch[2] || ''; // + æˆ– K
        if (num === '5' && suffix === '+') return 'CCTV5+';
        if ((num === '4' || num === '8') && suffix.toUpperCase() === 'K') return 'CCTV' + num + 'K';
        return 'CCTV' + num;
    }

    let clean = name;

    // å»æ‰"è¶…æ¸…ã€é«˜æ¸…ã€æ ‡æ¸…ã€HDã€SD"ç­‰åŠå…¶åå†…å®¹
    let hdIndex = clean.search(/è¶…æ¸…|è¶…é«˜æ¸…|ææ¸…|é«˜æ¸…|æ ‡æ¸…|HD|SD/i);
    if (hdIndex !== -1) {
        clean = clean.substring(0, hdIndex);
    }

    // âœ… å»æ‰æ‰€æœ‰ä¸­è‹±æ–‡æ‹¬å·åŠå†…å®¹ï¼ŒåŒ…æ‹¬ï¼ˆï¼‰ã€ã€ã€‘ã€[]ã€()ã€ï½›ï½ç­‰
    clean = clean.replace(/[\[\(ï¼ˆã€ï½›<ï¼œ].*?[\]\)ï¼‰ã€‘ï½>ï¼]/gu, '');

    // âœ… å†æ¬¡æ¸…é™¤å­¤ç«‹æ‹¬å·ï¼ˆé˜²æ­¢åŒ¹é…ä¸å®Œæ•´æ®‹ç•™ï¼‰
    clean = clean.replace(/[ï¼ˆã€ï½›\[<ï¼œ>\]ï¼‰ã€‘ï½ï¼]/gu, '');

    // âœ… å»æ‰çŸ­æ¨ªçº¿ã€ä¸‹åˆ’çº¿ã€ç©ºæ ¼
    clean = clean.replace(/[-_]/g, '').trim();

    return clean;
}

// ===== TXT â†’ M3U =====
function txtToM3u(){
    let epg=document.getElementById('epg').value.trim()||'https://epg.v1.mk/fy.xml';
    let logoBase=document.getElementById('logoBase').value.trim()||'https://live.404003.xyz/LOGO/';
    let sanitizeDisplay=document.getElementById('sanitizeDisplay').checked;
    let reGroup=document.getElementById('reGroup').checked;
    let input=document.getElementById('input').value.trim();
    if(!input){alert("è¯·è¾“å…¥ TXT å†…å®¹ï¼");return;}

    let lines=input.split(/\r?\n/);
    let result='#EXTM3U x-tvg-url="'+epg+'"\n';
    let currentGroup='';
    for(let line of lines){
        line=line.trim();
        if(!line) continue;
        if(line.includes(',#genre#')){
            currentGroup=line.split(',')[0];
            continue;
        }

        // åªæŒ‰ç¬¬ä¸€ä¸ªé€—å·åˆ‡åˆ†ï¼Œä¿ç•™ URL ä¸­çš„æ‰€æœ‰é€—å·
        let idx = line.indexOf(',');
        if(idx === -1) continue; // æ²¡æœ‰é€—å·çš„è¡Œè·³è¿‡
        let name = line.slice(0, idx).trim();
        let url  = line.slice(idx + 1).trim(); // ä¿ç•™åé¢æ‰€æœ‰å†…å®¹ï¼ˆåŒ…å«é€—å·ï¼‰

        if(!name || !url) continue;

        let cleanName = sanitizeName(name);
        // å¦‚æœå‹¾é€‰é‡æ–°åˆ†ç»„åˆ™æŒ‰è§„åˆ™åˆ†ç»„ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨å½“å‰åˆ†ç»„ï¼ˆcurrentGroupï¼‰
        let group = reGroup ? matchGroup(name) : (currentGroup || matchGroup(name));
        let logo = logoBase + cleanName + '.png';
        let displayName = sanitizeDisplay ? cleanName : name;

        result += '#EXTINF:-1 tvg-id="'+cleanName+'" tvg-name="'+cleanName+'" tvg-logo="'+logo+'" group-title="'+group+'",'+displayName+'\n'+url+'\n';
    }
    document.getElementById('output').value = result.trim();
}

// ===== M3U â†’ TXT =====ï¼ˆå·²å¢å¼ºå®¹é”™å¤„ç†ï¼‰
function m3uToTxt(){
    let input=document.getElementById('input').value.trim();
    if(!input){alert("è¯·è¾“å…¥ M3U å†…å®¹ï¼");return;}
    let useTvgName=document.getElementById('useTvgName').checked;
    let reGroup=document.getElementById('reGroup').checked;

    let lines=input.split(/\r?\n/);
    let groups={};
    for(let i=0;i<lines.length;i++){
        let line=lines[i].trim();
        if(!line.startsWith('#EXTINF')) continue;
        line=line.replace(/^#EXTINF:-1,?/, '#EXTINF:-1 ');
        let tvgName=line.match(/tvg-name="([^"]*)"/);
        let tvgId=line.match(/tvg-id="([^"]*)"/);
        let groupMatch=line.match(/group-title="([^"]*)"/);
        let extinfName=line.split(',').slice(1).join(',').trim();
        let name='æœªçŸ¥é¢‘é“';
        if(useTvgName) name=(tvgName?tvgName[1]:(tvgId?tvgId[1]:extinfName))||'æœªçŸ¥é¢‘é“';
        else name=extinfName||tvgName?.[1]||tvgId?.[1]||'æœªçŸ¥é¢‘é“';
        let group=reGroup ? matchGroup(name) : (groupMatch?groupMatch[1]:matchGroup(name));
        let url=(i+1<lines.length&&!lines[i+1].startsWith('#'))?lines[++i].trim():'';
        if(!groups[group])groups[group]=[];
        groups[group].push(`${name},${url}`);
    }
    let result='';
    for(let g in groups){
        result+=`${g},#genre#\n${groups[g].join('\n')}\n`;
    }
    document.getElementById('output').value=result.trim();
}

function clearAll(){
    document.getElementById('input').value='';
    document.getElementById('output').value='';
    // åŒæ—¶æ¸…ç©ºæ–‡ä»¶ä¸Šä¼ ç›¸å…³æ˜¾ç¤º
    document.getElementById('fileInput').value = '';
    document.getElementById('fileName').textContent = '';
    document.getElementById('fileInfo').textContent = 'æ”¯æŒ .txt å’Œ .m3u æ ¼å¼';
}

function copyOutput(){
    let output=document.getElementById('output');
    output.select();
    output.setSelectionRange(0,99999);
    document.execCommand('copy');
    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
}

function reGroup(){
    const output = document.getElementById('output');
    const input = document.getElementById('input').value.trim();
    if(!input){
        output.value = "âš ï¸ è¯·å…ˆè¾“å…¥å†…å®¹ï¼";
        return;
    }

    const lines = input.split(/\r?\n/);
    const isM3U = lines.some(line => line.startsWith('#EXTINF'));
    const entries = [];

    if(isM3U){
        for(let i=0;i<lines.length;i++){
            const line = lines[i].trim();
            if(line.startsWith('#EXTINF')){
                const nameMatch = line.match(/tvg-name="([^"]*)"/) || line.match(/tvg-id="([^"]*)"/);
                const name = nameMatch ? nameMatch[1] : 'æœªçŸ¥é¢‘é“';
                const url = (i+1<lines.length && !lines[i+1].startsWith('#')) ? lines[i+1].trim() : '';
                entries.push({name, url, raw: line});
            }
        }
    } else {
        for(const ln of lines){
            const line = ln.trim();
            if(!line || line.includes(',#genre#')) continue;
            const parts = line.split(',');
            if(parts.length < 2) continue;
            const name = parts[0].trim();
            const url = parts[1].trim();
            entries.push({name, url});
        }
    }

    // å„çœå°è¯†åˆ«å…³é”®å­—
    const provinces = ['åŒ—äº¬','å¤©æ´¥','æ²³åŒ—','å±±è¥¿','å†…è’™å¤','è¾½å®','å‰æ—','é»‘é¾™æ±Ÿ','ä¸Šæµ·','æ±Ÿè‹','æµ™æ±Ÿ','å®‰å¾½','ç¦å»º','æ±Ÿè¥¿','å±±ä¸œ','æ²³å—','æ¹–åŒ—','æ¹–å—','å¹¿ä¸œ','å¹¿è¥¿','æµ·å—','é‡åº†','å››å·','è´µå·','äº‘å—','è¥¿è—','é™•è¥¿','ç”˜è‚ƒ','é’æµ·','å®å¤','æ–°ç–†','å…µå›¢'];

    // ä¸ºæ¯ä¸ªé¢‘é“è¯†åˆ«åˆ†ç»„
    for(const e of entries){
        let group = matchGroup(e.name);
        if(group === 'é»˜è®¤'){
            const prov = provinces.find(p => e.name.includes(p));
            if(prov) {
                group = prov;
            } else if(/å«è§†/.test(e.name)) {
                group = 'å«è§†';
            } else {
                group = 'å…¶ä»–';
            }
        }
        e.group = group;
    }

    // ä¼˜å…ˆçº§æ’åºå‡½æ•°ï¼ˆç»„é¡ºåºï¼‰
    function groupPriority(g){
        if(g === 'å¤®è§†') return 0;
        if(g === 'å«è§†') return 1;
        if(provinces.includes(g)) return 2;
        if(g === 'æ•°å­—') return 3;
		if(g === 'SiTV') return 4;
        if(g === 'NewTV') return 5;
        if(g === 'BesTV') return 6;
        if(g === 'iHOT') return 7;
        return 999;
    }

    // æŒ‰ç»„èšåˆï¼ˆä¿æŒé¢‘é“å‡ºç°é¡ºåºï¼‰
    const grouped = {};
    for(const e of entries){
        if(!grouped[e.group]) grouped[e.group] = [];
        grouped[e.group].push(e);
    }

    // è·å–æ‰€æœ‰ç»„åå¹¶æ’åº
    const groupNames = Object.keys(grouped).sort((a,b) => {
        const pa = groupPriority(a), pb = groupPriority(b);
        if(pa !== pb) return pa - pb;
        // è‹¥éƒ½ä¸ºçœçº§ï¼ŒæŒ‰ä¸­æ–‡åæ’åº
        if(pa === 2 && pb === 2) return a.localeCompare(b, 'zh-CN');
        return 0;
    });

    // è¾“å‡ºç»“æœï¼ˆä¿æŒåŸé¢‘é“é¡ºåºï¼‰
    let result = '';
    if(isM3U){
        const header = lines.find(l => l.startsWith('#EXTM3U')) || '#EXTM3U';
        result = header + '\n';
        for(const g of groupNames){
            for(const e of grouped[g]){
                let extinf = e.raw;
                // æ›¿æ¢ group-title
                if(/group-title="[^"]*"/.test(extinf)){
                    extinf = extinf.replace(/group-title="[^"]*"/, 'group-title="'+g+'"');
                } else {
                    extinf = extinf.replace(/(,)([^,]*)$/, ' group-title="'+g+'",$2');
                }
                result += extinf + '\n' + e.url + '\n';
            }
        }
    } else {
        for(const g of groupNames){
            result += g + ',#genre#\n';
            for(const e of grouped[g]){
                result += e.name + ',' + e.url + '\n';
            }
        }
    }

    output.value = result.trim();
}
</script>

</body>
</html>